<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ibn-e-Sina Portal</title>
<link rel="icon" type="image/png" href="images/image.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif;}
body{min-height:100vh;display:flex;flex-direction:column;align-items:center;transition:background 0.8s;}
header{
  width:100%;display:flex;justify-content:space-between;align-items:center;
  padding:10px 20px;background:linear-gradient(to bottom,rgba(17,17,17,0.9),rgba(17,17,17,0));
  position:fixed;top:0;z-index:100;transition:background 0.5s;
}
body{padding-top:90px;}
header img{height:50px;}
header button{padding:8px 16px;border:none;border-radius:5px;background:#6a0dad;color:white;cursor:pointer;font-weight:bold;}
header button:hover{background:#8b2ecc;}
h1{text-align:center;margin:20px 0 10px 0;color:white;}
h2{text-align:center;font-weight:400;margin-bottom:10px;color:#ccc;}
p.description{text-align:center;max-width:600px;margin-bottom:20px;color:white;}
.profile-img{width:150px;height:150px;border-radius:50%;display:block;margin:0 auto 20px auto;}
.actions{display:flex;flex-direction:column;gap:15px;margin-bottom:30px;width:250px;}
.actions button{padding:12px;border-radius:8px;border:none;background:#6a0dad;color:white;cursor:pointer;font-size:16px;font-weight:bold;transition:0.3s;}
.actions button:hover{background:#8b2ecc;}
.loading-container {display: flex;justify-content: center;margin-top: 20px;}
.loading-gif {width: 80px;height: auto;}
.modal-bg{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:1000;animation:fadeIn 0.3s;}
.modal{background:#111;padding:20px;border-radius:10px;width:90%;max-width:400px;display:flex;flex-direction:column;gap:15px;animation:slideIn 0.3s;}
.modal input,.modal textarea{width:100%;padding:10px;border-radius:5px;border:1px solid #555;background:#222;color:white;}
.modal button{padding:10px;border-radius:5px;border:none;background:#6a0dad;color:white;font-weight:bold;cursor:pointer;}
.modal .close{background:#333;}
.modal h3{color:white;margin-bottom:10px;text-align:center;}
.vote-container{display:flex;justify-content:center;align-items:center;gap:10px;margin-top:5px;}
.vote-btn{cursor:pointer;background:#444;border:none;padding:5px 10px;border-radius:5px;color:white;}
.vote-count{color:white;font-weight:bold;}
#suggestions-container{margin-top:20px;width:90%;max-width:600px;display:flex;flex-direction:column;gap:15px;color:white;text-align:center;}
.suggestion-card{background:#222;padding:15px;border-radius:10px;color:white;}
/* Footer */
footer{
  margin:20px 0;
  text-align:center;
  color:#ccc;
  font-size:14px;
}
footer a{
  color:#6a0dad;
  text-decoration:none;
  font-weight:bold;
  transition: all 0.3s ease;
}
footer a:hover{
  color:#8b2ecc;
  text-decoration:underline;
}
@keyframes fadeIn{from{opacity:0;} to{opacity:1;}}
@keyframes slideIn{from{transform:translateY(-20px); opacity:0;} to{transform:translateY(0); opacity:1;}}
</style>
</head>
<body>

<header>
  <img src="images/image.png" alt="Ibn-e-Sina Logo">
  <div style="display:flex;gap:10px;">
    <button id="login-google-btn">Sign in with Google</button>
    <button id="login-email-btn">Sign in with Email</button>
  </div>
</header>

<img src="images/person.png" alt="Talal Mukhtar" class="profile-img">
<h1>Talal Mukhtar</h1>
<h2>Ibn-e-Sina Headboy</h2>
<p class="description">Share your thoughts with me and I'll try my best to get back to you asap</p>

<div class="actions">
  <button id="suggestion-btn">Submit Suggestion</button>
  <button id="complaint-btn">Submit Complaint</button>
</div>

<div id="loading-container" class="loading-container" style="display:none;">
  <span style="color:white;">Loading...</span>
</div>

<div id="suggestions-container"></div>

<!-- Modal for Email Login / Signup -->
<div class="modal-bg" id="email-modal">
  <div class="modal">
    <h3 id="email-modal-title">Sign in with Email</h3>
    <input type="email" id="email-input" placeholder="Email">
    <div style="position:relative;">
      <input type="password" id="password-input" placeholder="Password" style="width:100%; padding-right:40px;">
      <span id="toggle-password" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;color:#ccc;font-size:18px;">üëÅÔ∏è</span>
    </div>
    <button id="email-submit-btn">Sign In / Sign Up</button>
    <button class="close" id="email-close-btn">Cancel</button>
    <button id="reset-password-btn" style="background:#444;margin-top:5px;">Reset Password</button>
  </div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCGkF5OkclTr8Xjxe5XW3rjrP3vh4Dr2Ws",
    authDomain: "ibn-e-sina-school.firebaseapp.com",
    projectId: "ibn-e-sina-school",
    storageBucket: "ibn-e-sina-school.appspot.com",
    messagingSenderId: "897865466373",
    appId: "1:897865466373:web:107271a0b6b9e7fd36126c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginGoogleBtn = document.getElementById('login-google-btn');
const loginEmailBtn = document.getElementById('login-email-btn');
const emailModal = document.getElementById('email-modal');
const emailCloseBtn = document.getElementById('email-close-btn');
const emailSubmitBtn = document.getElementById('email-submit-btn');
const emailInput = document.getElementById('email-input');
const passwordInput = document.getElementById('password-input');
const togglePassword = document.getElementById('toggle-password');
const resetPasswordBtn = document.getElementById('reset-password-btn');

let user = null;

// Google login
loginGoogleBtn.onclick = () => {
  if(!user){
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(res=>{
      user=res.user;
      updateButtons();
      loadSuggestions();
    }).catch(err=>alert(err.message));
  } else {
    auth.signOut().then(()=>{user=null; updateButtons();});
  }
};

// Email login modal
loginEmailBtn.onclick = () => {
  emailModal.style.display='flex';
};

// Close modal
emailCloseBtn.onclick = ()=>{ emailModal.style.display='none'; };

// Toggle password visibility
togglePassword.onclick = ()=> {
  if(passwordInput.type==='password') passwordInput.type='text';
  else passwordInput.type='password';
};

// Reset password
resetPasswordBtn.onclick = async () => {
  const email = emailInput.value.trim();
  if(!email){ alert("Enter your email first."); return; }
  try{
    await auth.sendPasswordResetEmail(email);
    alert("‚úÖ Password reset email sent. Check inbox/junk folder. Then sign in with new password.");
    emailModal.style.display='none';
  }catch(err){ alert("‚ùå "+err.message); }
};

// Email sign in/sign up
emailSubmitBtn.onclick = async () => {
  const email = emailInput.value.trim();
  const pass = passwordInput.value.trim();
  if(!email||!pass){ alert("Fill both email and password."); return; }
  try{
    const signInRes = await auth.signInWithEmailAndPassword(email, pass);
    if(!signInRes.user.emailVerified){
      alert("‚ö†Ô∏è Email not verified. Check inbox/junk folder.");
      auth.signOut();
      return;
    }
    user = signInRes.user;
    updateButtons();
    loadSuggestions();
    emailModal.style.display='none';
  }catch(err){
    if(err.code==='auth/user-not-found'){
      try{
        const signupRes = await auth.createUserWithEmailAndPassword(email, pass);
        await signupRes.user.sendEmailVerification();
        alert("‚úÖ Verification email sent. Check inbox/junk folder, then sign in again.");
        auth.signOut();
      }catch(e){ alert(e.message); }
    } else alert(err.message);
  }
};

// Update button visibility
function updateButtons(){
  loginGoogleBtn.textContent = user ? 'Logout' : 'Sign in with Google';
  loginEmailBtn.style.display = user ? 'none' : 'inline-block';
}

auth.onAuthStateChanged(u=>{
  user = u;
  updateButtons();
  if(user) loadSuggestions();
});

// Random background
function getRandomGradient(){
  const darks=[
    'linear-gradient(to bottom,#1a1a1a,#2c2c2c)',
    'linear-gradient(to bottom,#0d0d2c,#1a1a4d)',
    'linear-gradient(to bottom,#1a1a1a,#003300)',
    'linear-gradient(to bottom,#111111,#220022)'
  ];
  return darks[Math.floor(Math.random()*darks.length)];
}
document.body.style.background=getRandomGradient();

// Placeholder for loadSuggestions
async function loadSuggestions(){
  document.getElementById('suggestions-container').innerHTML='Loading...';
  // ... your previous suggestion loading code
}

</script>

<footer>
  Made by Raahim Fahd, 9 Green, 
  <a href="https://github.com/iscsuggest/isc" target="_blank">Source code</a>
</footer>

</body>
</html>
